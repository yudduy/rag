"use strict";(()=>{var e={};e.id=311,e.ids=[311],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32307:e=>{e.exports=require("next/dist/server/app-render/prerender-async-storage.external.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},36739:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>d,PATCH:()=>l});var a=r(38728),s=r(64006),o=r(64615),i=r(89228),u=r(21080);async function d(e){let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return new Response("Not Found!",{status:404});let n=await (0,i.I8)();if(!n||!n.user)return new Response("Unauthorized!",{status:401});try{let e=await (0,u.Qv)({id:r});if(!e)return new Response("Reservation not found!",{status:404});if(e.userId!==n.user.id)return new Response("Unauthorized!",{status:401});return Response.json(e)}catch(e){return new Response("An error occurred while processing your request!",{status:500})}}async function l(e){let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return new Response("Not Found!",{status:404});let n=await (0,i.I8)();if(!n||!n.user)return new Response("Unauthorized!",{status:401});try{let t=await (0,u.Qv)({id:r});if(!t)return new Response("Reservation not found!",{status:404});if(t.userId!==n.user.id)return new Response("Unauthorized!",{status:401});if(t.hasCompletedPayment)return new Response("Reservation is already paid!",{status:409});let{magicWord:a}=await e.json();if(!a||"string"!=typeof a)return new Response("Magic word is required and must be a string!",{status:400});if("vercel"!==a.toLowerCase())return new Response("Invalid magic word!",{status:400});let s=await (0,u.mU)({id:r,hasCompletedPayment:!0});return Response.json(s)}catch(e){return console.error("Error updating reservation:",e),new Response("An error occurred while processing your request!",{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/(chat)/api/reservation/route",pathname:"/api/reservation",filename:"route",bundlePath:"app/(chat)/api/reservation/route"},resolvedPagePath:"/Users/duy/Documents/build/rag/app/(chat)/api/reservation/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,prerenderAsyncStorage:m,serverHooks:f}=c;function w(){return(0,o.patchFetch)({staticGenerationAsyncStorage:h,requestAsyncStorage:p,prerenderAsyncStorage:m})}},89228:(e,t,r)=>{r.d(t,{HT:()=>i,a4:()=>u,I8:()=>d,w7:()=>c});var n=r(75032),a=r(81218),s=r(45807),o=r(21080);let{handlers:{GET:i,POST:u},auth:d,signIn:l,signOut:c}=(0,a.ZP)({pages:{signIn:"/login",newUser:"/"},providers:[],callbacks:{authorized({auth:e,request:{nextUrl:t}}){let r=!!e?.user,n=t.pathname.startsWith("/"),a=t.pathname.startsWith("/register"),s=t.pathname.startsWith("/login");return r&&(s||a)?Response.redirect(new URL("/",t)):!!a||!!s||(n?!!r:!r||Response.redirect(new URL("/",t)))}},providers:[(0,s.Z)({credentials:{},async authorize({email:e,password:t}){if(!e||!t)return null;let r=await (0,o.PR)(e);if(0===r.length)return null;let a=r[0];return a.password&&await (0,n.qu)(t,a.password)?a:null}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id),e)}})},21080:(e,t,r)=>{r.d(t,{OE:()=>I,Rr:()=>j,LT:()=>P,g6:()=>E,T:()=>L,AN:()=>U,cQ:()=>S,Qv:()=>T,PR:()=>A,l_:()=>b,xd:()=>F,mU:()=>C}),r(75032);var n=r(40986),a=r(6931),s=r(19975),o=r(32219),i=r(49141),u=r(85332),d=r(45220),l=r(17714),c=r(33866),p=r(62746),h=r(80346),m=r(27883),f=r(78367),w=r(73977);let y=(0,i.af)("User",{id:(0,u.Vj)("id").primaryKey().notNull().defaultRandom(),email:(0,d.L7)("email",{length:64}).notNull(),password:(0,d.L7)("password",{length:128})},e=>({uniqueEmail:(0,l.Tw)().on(e.email)})),g=(0,i.af)("Chat",{id:(0,u.Vj)("id").primaryKey().notNull().defaultRandom(),createdAt:(0,c.AB)("createdAt").notNull(),messages:(0,p.AV)("messages").notNull(),userId:(0,u.Vj)("userId").notNull().references(()=>y.id)}),R=(0,i.af)("Reservation",{id:(0,u.Vj)("id").primaryKey().notNull().defaultRandom(),createdAt:(0,c.AB)("createdAt").notNull(),details:(0,p.AV)("details").notNull(),hasCompletedPayment:(0,h.O7)("hasCompletedPayment").notNull().default(!1),userId:(0,u.Vj)("userId").notNull().references(()=>y.id)}),q=(0,i.af)("Document",{id:(0,u.Vj)("id").primaryKey().notNull().defaultRandom(),filename:(0,d.L7)("filename",{length:255}).notNull(),originalName:(0,d.L7)("originalName",{length:255}).notNull(),fileType:(0,d.L7)("fileType",{length:50}).notNull(),fileSize:(0,m._L)("fileSize").notNull(),content:(0,f.fL)("content").notNull(),status:(0,d.L7)("status",{length:20}).notNull().default("indexed"),chunkCount:(0,m._L)("chunkCount").notNull().default(0),createdAt:(0,c.AB)("createdAt").notNull().default((0,w.i6)`CURRENT_TIMESTAMP`),updatedAt:(0,c.AB)("updatedAt").notNull().default((0,w.i6)`CURRENT_TIMESTAMP`),userId:(0,u.Vj)("userId").notNull().references(()=>y.id,{onDelete:"cascade"})}),v=process.env.POSTGRES_URL?(()=>{let e=new URL(process.env.POSTGRES_URL);return e.searchParams.set("sslmode","require"),e.toString()})():"postgres://dummy:dummy@localhost:5432/dummy",x=(0,o.Z)(v,{max:1,transform:process.env.POSTGRES_URL?o.Z.camel:void 0}),N=(0,s.t)(x);async function A(e){try{return await N.select().from(y).where((0,n.eq)(y.email,e))}catch(e){throw console.error("Failed to get user from database"),e}}async function b({id:e,messages:t,userId:r}){try{if((await N.select().from(g).where((0,n.eq)(g.id,e))).length>0)return await N.update(g).set({messages:JSON.stringify(t)}).where((0,n.eq)(g.id,e));return await N.insert(g).values({id:e,createdAt:new Date,messages:JSON.stringify(t),userId:r})}catch(e){throw console.error("Failed to save chat in database"),e}}async function P({id:e}){try{return await N.delete(g).where((0,n.eq)(g.id,e))}catch(e){throw console.error("Failed to delete chat by id from database"),e}}async function U({id:e}){try{return await N.select().from(g).where((0,n.eq)(g.userId,e)).orderBy((0,a.C)(g.createdAt))}catch(e){throw console.error("Failed to get chats by user from database"),e}}async function L({id:e}){try{let[t]=await N.select().from(g).where((0,n.eq)(g.id,e));return t}catch(e){throw console.error("Failed to get chat by id from database"),e}}async function j({id:e,userId:t,details:r}){return await N.insert(R).values({id:e,createdAt:new Date,userId:t,hasCompletedPayment:!1,details:JSON.stringify(r)})}async function T({id:e}){let[t]=await N.select().from(R).where((0,n.eq)(R.id,e));return t}async function C({id:e,hasCompletedPayment:t}){return await N.update(R).set({hasCompletedPayment:t}).where((0,n.eq)(R.id,e))}async function I({filename:e,originalName:t,fileType:r,fileSize:n,content:a,userId:s}){try{let[o]=await N.insert(q).values({filename:e,originalName:t,fileType:r,fileSize:n,content:a,userId:s,status:"indexed",chunkCount:0}).returning();return o}catch(e){throw console.error("Failed to create document in database"),e}}async function S({id:e}){try{let[t]=await N.select().from(q).where((0,n.eq)(q.id,e));return t}catch(e){throw console.error("Failed to get document by id from database"),e}}async function F({id:e,chunkCount:t}){try{return await N.update(q).set({chunkCount:t,updatedAt:new Date}).where((0,n.eq)(q.id,e))}catch(e){throw console.error("Failed to update document chunk count"),e}}async function E({id:e}){try{return await N.delete(q).where((0,n.eq)(q.id,e))}catch(e){throw console.error("Failed to delete document by id from database"),e}}},38728:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[615,503],()=>r(36739));module.exports=n})();